@using OutWeb.Models.Manage.IPModels
@model IPListViewModel
@{
    Layout = "~/Views/Shared/_MLayout.cshtml";
    ViewBag.Crumb = "IP登入來源";
    ViewBag.subnav = "Cog";
    ViewBag.subnav2 = "IP";
}

@section Breadcrumb {
    <ul class="breadcrumb">
        <li>系統設定</li>
        <li>@ViewBag.Crumb</li>
    </ul>
}
@section IncludeScript{

    <script>

        (function ($) {
            $(function () {
                //搜尋
                $('#searchBtn').click(function () {
                    $('#numPage').val(1);
                    $('#frmIpList').submit();
                });

                //分頁input
                $('#numPage').on('keyup mouseup', function () {
                    var minPage = @Model.Result.Pagination.FirstPage;
                    var maxPage = @Model.Result.Pagination.LastPage;
                    var currentPage=$(this).val() ;
                    if(currentPage < minPage)
                    {
                        currentPage = minPage;
                    }

                    if(currentPage > maxPage)
                    {
                        currentPage = maxPage;
                    }
                    $(this).val(currentPage);
                    $('#frmIpList').submit();
                });
            });
        })(jQuery);
    </script>
}
<h3 class="title">@ViewBag.Crumb</h3>
@{
    string beginDateStr = Model.Filter.BeginDate == DateTime.MinValue ? "" : Model.Filter.BeginDate.ToString("yyyy\\/MM\\/dd");
    string endDateStr = Model.Filter.EndDate == DateTime.MaxValue ? "" : Model.Filter.EndDate.ToString("yyyy\\/MM\\/dd");
}
@using (Html.BeginForm("IP", "_SysAdm", FormMethod.Get, new { id = "frmIpList" }))
{
    <header class="table-head form-inline">
        <input type="text" class="datepicker" name="bDate" value="@beginDateStr">~<input type="text" class="datepicker" name="eDate" value="@endDateStr">
        <input type="text" placeholder="請輸入關鍵字" name="qry" value="@Model.Filter.QueryString">
        <button class="btn" id="searchBtn" type="button">搜尋</button>
    </header>

    <table class="table-list table-hover table-striped">
        <colgroup>
            <col span="2">
            <col style="width: 28%">
        </colgroup>
        <tr>
            <th class="text-left">IP</th>
            <th class="text-left"><button id="sortDisplayForFront" type="button" sort-type="" class="th-sort-toggle">登入時間</button></th>
            <th class="text-left"><button id="sortDisplayForFront" type="button" sort-type="" class="th-sort-toggle">登入帳號</button></th>
        </tr>
        @foreach (var data in Model.Result.Data)
        {
            <tr>
                <td class="text-left">@data.FromIP</td>
                <td class="text-left">@data.OperateDate.ToString("yyyy\\/MM\\/dd hh:mm")</td>
                <td class="text-left">@data.OperateID</td>
            </tr>
        }

    </table>

    <footer class="table-foot">
        @{
            int beginCount = Model.Result.Pagination.CurrentPage > 1 ? ((Model.Result.Pagination.CurrentPage - 1) * Model.Result.Pagination.PageSize) + 1 : 1;
            int lastCount =
                Model.Result.Data.Count >= Model.Result.Pagination.PageSize ?
                ((Model.Result.Pagination.CurrentPage) * Model.Result.Pagination.PageSize) : Model.Result.Pagination.DataCount;
            string disabledPre = Model.Result.Pagination.CurrentPage == 1 ? "disabled" : "";
            string disabledNext = Model.Result.Pagination.CurrentPage == Model.Result.Pagination.LastPage ? "disabled" : "";
            string disabledPageInput = Model.Result.Pagination.LastPage == 1 ? "disabled" : "";
        }
        <small class="pull-right">第 @beginCount - @lastCount 筆，共 @Model.Result.Pagination.DataCount 筆</small>
        <nav class="pager">
            <button @disabledPre class="oi" data-glyph="media-step-backward" title="到最前頁" type="button" onclick="paginationSubmit('@Model.Result.Pagination.FirstPage');"></button>
            <button @disabledPre class="oi" data-glyph="chevron-left" title="上一頁" type="button" onclick="paginationSubmit('@Model.Result.Pagination.PrePage');"></button>
            <span>第<input @disabledPageInput id="numPage" name="page" class="text-center" type="number" value="@Model.Result.Pagination.CurrentPage">頁，共 @Model.Result.Pagination.LastPage 頁</span>
            <button @disabledNext class="oi" data-glyph="chevron-right" title="下一頁" type="button" onclick="paginationSubmit('@Model.Result.Pagination.NextPage');"></button>
            <button @disabledNext class="oi" data-glyph="media-step-forward" title="到最後頁" type="button" onclick="paginationSubmit('@Model.Result.Pagination.LastPage')"></button>
        </nav>
    </footer>
            }

<script>
    function paginationSubmit(page)
    {
        $('#numPage').val(page);
        $('form')[0].submit();
    }
</script>