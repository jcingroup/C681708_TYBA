@using OutWeb.Models.Manage.TypeManageModels
@model TypeManageListViewModel
@{
    Layout = "~/Views/Shared/_MLayout.cshtml";
    ViewBag.Crumb = "出版品分類維護";
    ViewBag.subnav = "Books";
    ViewBag.subnav2 = "BookKind";
}

@section Breadcrumb {
    <ul class="breadcrumb">
        <li>出版品分類管理</li>
        <li>@ViewBag.Crumb</li>
    </ul>
}
@section IncludeScript{
    <script>
        (function ($) {
            $(function () {
                $('#statusDropList').val('@Model.Filter.Status');

                //下拉選單change
                //$('#typeList').on('change',function () {
                //    $('#formManageTypeManage').submit();
                //})

                $('.sub-btn').click(function () {
                    var typeID = $(this).attr('id');
                    window.location.href = '@Url.Content("~/_SysAdm/BookKintList?type=")' +typeID;
                });
                //搜尋
                $('#searchBtn').click(function () {
                    $('#numPage').val(1);
                    $('#formManageTypeManage').submit();
                });

                //分頁input
                $('#numPage').on('keyup mouseup', function () {
                    var minPage = @Model.Result.Pagination.FirstPage;
                    var maxPage = @Model.Result.Pagination.LastPage;
                    var currentPage=$(this).val() ;
                    if(currentPage < minPage)
                    {
                        currentPage = minPage;
                    }

                    if(currentPage > maxPage)
                    {
                        currentPage = maxPage;
                    }
                    $(this).val(currentPage);
                    $('#formBookKindListManage').submit();
                });

                //刪除
                $('.delete-btn').click(function () {
                    @{
                        int FilterTypeID = Model.Filter.TypeID ?? default(int);
                    }

                    var id = $(this).attr('data-id');
                    var url = "@Url.Content("~/_SysAdm/BookKindDelete")";
                    var filterTypeID = parseInt('@FilterTypeID');
                    var sendData = {};

                    if(filterTypeID > 0)
                    {
                        sendData =  { ID: id, filterTypeID:filterTypeID};
                    }
                    else
                    {
                        sendData =  { ID: id};
                    }
                    $.ajax({
                        async: false,
                        url: url,
                        data: sendData,
                        type: 'POST',
                        dataType: 'json',
                        success: function (data) {
                            if (data.success) {
                                alert(data.messages);
                                window.location.reload()
                            }
                            else {
                                //$('#error_msg').html(data.messages);
                                alert(data.messages);
                            }
                        }, error: function (error) {
                            //$('#error_msg').html(data.messages);
                            alert(error.messages);
                        }
                    });
                })

                //排序
                $('.th-sort-toggle').on('click', function () {
                    var sortNm = $(this).attr('id');
                    var sortType = $(this).attr('sort-type') == '' ? 'asc' : $(this).attr('sort-type');
                    if('@Model.Filter.TypeID' != '')
                    {
                        window.location = '@Url.Content("~/_SysAdm/BookKindList")' + "?&sort=" + sortNm + '/' + sortType + '&page=@Model.Result.Pagination.CurrentPage' + '&type=@Model.Filter.TypeID';
                    }
                    else
                    {
                        window.location = '@Url.Content("~/_SysAdm/BookKindList")' + "?&sort=" + sortNm + '/' + sortType + '&page=@Model.Result.Pagination.CurrentPage';
                    }
                })

                var sortColumn;
                var sortTp;
                if ('@Model.Filter.SortColumn' != '') {
                    sortColumn = '@Model.Filter.SortColumn'.split('/')[0]
                    sortTp = '@Model.Filter.SortColumn'.split('/')[1];
                }

                if (sortTp == 'asc') {
                    sortTp = 'desc';
                }
                else {
                    sortTp = 'asc';
                }

                switch (sortColumn) {

                    case "sortName":
                        $('#sortName').addClass(sortTp)
                        $('#sortName').attr('sort-type', sortTp);
                        break;

                    case "sortStatus":
                        $('#sortStatus').addClass(sortTp)
                        $('#sortStatus').attr('sort-type', sortTp);
                        break;
                    case "sortIndex":
                        $('#sortIndex').addClass(sortTp)
                        $('#sortIndex').attr('sort-type', sortTp);
                        break;
                    default:
                        break;
                }
            });
        })(jQuery);
</script>
}
<h3 class="title">@ViewBag.Crumb</h3>
@using (Html.BeginForm("BookKindList", "_SysAdm", FormMethod.Get, new { id = "formBookKindListManage" }))
{
    <div class="alert-warning mb-16">
        <strong>排序：</strong> 數字愈大愈前面。
    </div>

    <div class="btn-group mb-8">
        <button type="button" class="btn success oi" data-glyph="plus" onclick="location.href='@Url.Content("~/_SysAdm/BookKindAdd?filterTypeID=" + Model.Filter.TypeID)'">新增</button>
    </div>

    <header class="table-head form-inline">
        <label>狀態</label>
        <select id="statusDropList" name="status">
            <option value="">全部</option>
            <option value="Y">啟用</option>
            <option value="N">停用</option>
        </select>


        <input type="text" placeholder="請輸入關鍵字" name="qry">
        <button class="btn">搜尋</button>
    </header>
    <table class="table-list table-hover table-striped">
        <colgroup>
            <col span="2">
            <col>
            <col span="3" style="width: 12%">
        </colgroup>
        <tr>
            @* 點選排序功能 (點一下遞增, 點兩下遞減)
                <button class="th-sort-toggle"></button>
                遞增 asc
                <button class="th-sort-toggle asc"></button>
                遞減 desc
                <button class="th-sort-toggle desc"></button>
            *@
            <th class="item-edit">刪除</th>
            <th class="item-edit">修改</th>
            <th class="text-left">名稱</th>
            <th><button id="" type="button" sort-type="" class="th-sort-toggle">狀態</button></th>
            <th><button id="sortIndex" type="button" sort-type="" class="th-sort-toggle">排序</button></th>
        </tr>
        @if (Model.Result.Data.Count == 0)
        {
            <tr class="bg-pale-red"><td colspan="5">查無資料!</td></tr>
        }
        @foreach (var data in Model.Result.Data)
        {
            string disDisabledStr = data.Disabled ? "停用" : "啟用";
            string disDisabledStyle = data.Disabled ? "label" : "label-success";
            <tr>

                <td><button type="button" class="hover-danger oi delete-btn" title="刪除" data-glyph="trash" data-id="@data.ID"></button></td>
                <td><button type="button" class="hover-primary oi" title="修改" data-glyph="pencil" onclick="location.href='@Url.Content("~/_SysAdm/BookKindEdit?ID=" + data.ID + "&filterTypeID=" + Model.Filter.TypeID)'"></button></td>
                <td class="text-left">@data.TypeName</td>
                <td><span class="@disDisabledStyle">@disDisabledStr</span></td>
                <td>@data.Sort</td>
            </tr>

            @*<tr>
                    <td><button class="hover-danger oi delete-btn" title="刪除" type="button" data-glyph="trash"></button></td>
                    <td><button class="hover-primary oi" title="修改" data-glyph="pencil" type="button" onclick="location.href='@Url.Content("BookKindEdit")'"></button></td>
                    <td class="text-left">能源查核年報</td>
                    <td><span class="label-success">使用</span></td>
                    <td>1</td>
                </tr>*@
        }

        @*<tr>
                <td><button class="hover-danger oi delete-btn" title="刪除" type="button" data-glyph="trash"></button></td>
                <td><button class="hover-primary oi" title="修改" data-glyph="pencil" type="button" onclick="location.href='@Url.Content("BookKindEdit")'"></button></td>
                <td class="text-left">節約能源要覽</td>
                <td><span class="label-success">使用</span></td>
                <td>1</td>
            </tr>
            <tr>
                <td><button class="hover-danger oi delete-btn" title="刪除" type="button" data-glyph="trash"></button></td>
                <td><button class="hover-primary oi" title="修改" data-glyph="pencil" type="button" onclick="location.href='@Url.Content("BookKindEdit")'"></button></td>
                <td class="text-left">技術手冊</td>
                <td><span class="label-success">使用</span></td>
                <td>1</td>
            </tr>
            <tr>
                <td><button class="hover-danger oi delete-btn" title="刪除" type="button" data-glyph="trash"></button></td>
                <td><button class="hover-primary oi" title="修改" data-glyph="pencil" type="button" onclick="location.href='@Url.Content("BookKindEdit")'"></button></td>
                <td class="text-left">xxxxxxxxx</td>
                <td><span class="label">停用</span></td>
                <td>1</td>
            </tr>*@
    </table>

    <footer class="table-foot">
        @{
            int beginCount = Model.Result.Pagination.CurrentPage > 1 ? ((Model.Result.Pagination.CurrentPage - 1) * Model.Result.Pagination.PageSize) + 1 : 1;
            int lastCount =
                Model.Result.Data.Count >= Model.Result.Pagination.PageSize ?
                ((Model.Result.Pagination.CurrentPage) * Model.Result.Pagination.PageSize) : Model.Result.Pagination.DataCount;
            string disabledPre = Model.Result.Pagination.CurrentPage == 1 ? "disabled" : "";
            string disabledNext = Model.Result.Pagination.CurrentPage == Model.Result.Pagination.LastPage ? "disabled" : "";
            string disabledPageInput = Model.Result.Pagination.LastPage == 1 ? "disabled" : "";
        }
        <small class="pull-right">第 @beginCount - @lastCount 筆，共 @Model.Result.Pagination.DataCount 筆</small>
        <nav class="pager">
            <button @disabledPre class="oi" data-glyph="media-step-backward" title="到最前頁" type="button" onclick="paginationSubmit('@Model.Result.Pagination.FirstPage');"></button>
            <button @disabledPre class="oi" data-glyph="chevron-left" title="上一頁" type="button" onclick="paginationSubmit('@Model.Result.Pagination.PrePage');"></button>
            <span>第<input @disabledPageInput id="numPage" name="page" class="text-center" type="number" value="@Model.Result.Pagination.CurrentPage">頁，共 @Model.Result.Pagination.LastPage 頁</span>
            <button @disabledNext class="oi" data-glyph="chevron-right" title="下一頁" type="button" onclick="paginationSubmit('@Model.Result.Pagination.NextPage');"></button>
            <button @disabledNext class="oi" data-glyph="media-step-forward" title="到最後頁" type="button" onclick="paginationSubmit('@Model.Result.Pagination.LastPage')"></button>
        </nav>
    </footer>
            }

<script>
    function paginationSubmit(page)
    {
        $('#numPage').val(page);
        $('form')[0].submit();
    }
</script>