@using OutWeb.Models.FrontEnd.QuestionnairesModels
@using OutWeb.Provider

@model QuestListViewModel
@{
    ViewBag.Title = "問卷填寫";
    ViewBag.BodyClass = "Question";
    ViewBag.Subnav = "Write";
    ViewBag.Breadcrumb = "已填寫問卷"; @* 最後層的麵包屑 *@
}

@* 中間層的麵包屑 *@
@section breadcrumb {
}

<div class="wrap zoom">
    @Html.Partial("../Question/sidebar")

    @* <h2 class="title underline mb-32">@ViewBag.Title</h2> *@

    <div id="content">

        <form class="list-search" action="/User/QuestionList" method="get" id="frmQuestionList">

            <div class="rwd-table">
                <table class="table-list table-hover">
                    <thead class="list-head">
                        <tr>
                            <th></th>
                            <th>是否開放</th>
                            <th class="text-left">名稱</th>
                            <th>已填寫人數</th>
                            <th>發佈日期</th>
                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var question in Model.Data)
                        {
                            string jsClass = string.Empty;
                            string redirectUrl = string.Empty;
                            if (question.IsLogin)
                            {
                                if (UserFrontProvider.Instance.User == null)
                                {
                                    redirectUrl = Url.Action("Login", "Home");
                                }
                                else
                                {
                                    redirectUrl = Url.Content("~/User/QuestionApply?ID=" + question.ID);
                                }
                            }
                            else
                            {
                                redirectUrl = Url.Content("~/User/QuestionApply?ID=" + question.ID);
                            }

                            if (question.Status)
                            {
                                if (question.IsFinish || question.IsNotyet)
                                {
                                    redirectUrl = "javascript:;";
                                    jsClass = "stopAns";
                                }
                                <tr>
                                    <td class="icon"></td>
                                    <td class="text-info" data-title="是否開放">@question.IsFinishOrIsNotYetStr</td>
                                    <td class="text-left" data-title="名稱"><a href="@redirectUrl" class="@jsClass">@question.Title</a></td>
                                    <td data-title="已填寫人數">@question.PeopleNumber</td>
                                    <td class="text-primary" data-title="發佈日期">@question.CreateDateStr</td>
                                </tr>
                            }

                        }

                    </tbody>
                </table>
            </div>


            <nav class="pager text-info">
                @{
                    int beginCount = Model.Pagination.CurrentPage > 1 ? ((Model.Pagination.CurrentPage - 1) * Model.Pagination.PageSize) + 1 : 1;
                    int lastCount =
                        Model.Data.Count >= Model.Pagination.PageSize ?
                        ((Model.Pagination.CurrentPage) * Model.Pagination.PageSize) : Model.Pagination.DataCount;
                    string disabledPre = Model.Pagination.CurrentPage == 1 ? "disabled" : "";
                    string disabledNext = Model.Pagination.CurrentPage == Model.Pagination.LastPage ? "disabled" : "";
                    string disabledPageInput = Model.Pagination.LastPage == 1 ? "disabled" : "";
                    string pageTotalInfo = string.Format("{0}/{1}頁 {2}筆", Model.Pagination.CurrentPage, Model.Pagination.LastPage, Model.Pagination.DataCount);
                }
                <span class="pull-left">
                    @pageTotalInfo
                </span>

                <a @disabledPre href="javascript:;"
                   onclick="location.href='@Url.Action("List", "Question", new { page = Model.Pagination.FirstPage })'"
                   class="btn ti-angle-double-left"><i class="sr-only">最前一筆</i></a>
                <a @disabledPre href="javascript:;"
                   onclick="location.href='@Url.Action("List", "Question", new { page = Model.Pagination.PrePage })'"
                   class="btn ti-angle-left"><i class="sr-only">上一筆</i></a>
                <a @disabledNext href="javascript:;"
                   onclick="location.href='@Url.Action("List", "Question", new { page = Model.Pagination.NextPage })'"
                   class="btn ti-angle-right"><i class="sr-only">下一筆</i></a>
                <a @disabledNext href="javascript:;"
                   onclick="location.href='@Url.Action("List", "Question", new { page = Model.Pagination.LastPage })'"
                   class="btn ti-angle-double-right"><i class="sr-only">最後一筆</i></a>

                <label for="numPage" class="ml-16">
                    第
                    <input @disabledPageInput id="numPage" name="page" class="form-element inline text-center" type="number" min="1" value="@Model.Pagination.CurrentPage">
                    頁
                </label>
            </nav>
        </form>

    </div>
</div>

@section scripts {
    <script>

        $(function () {
            $('a').each(function (i,e) {
                var $elm =$(e);
                if($elm.attr('disabled') != undefined)
                {
                    $elm.attr('href','javascript:;').attr('onclick','javascript:;');
                }
            });

            $('.stopAns').click(function () {
                alert('問卷已結束未開放');
            });

            //搜尋
            $('#searchBtn').click(function () {
                $('#numPage').val(1);
                $('#frmQuestionList').submit();
            });

            //分頁input
            $('#numPage').on('keyup change', function () {
                var minPage = @Model.Pagination.FirstPage;
                var maxPage = @Model.Pagination.LastPage;
                var currentPage=$(this).val() ;
                if(currentPage < minPage)
                {
                    currentPage = minPage;
                }

                if(currentPage > maxPage)
                {
                    currentPage = maxPage;
                }
                $(this).val(currentPage);
                $('#frmQuestionList').submit();
            })
        })

        if('@TempData["Error"]'!='')
        {
            alert('@TempData["Error"]');
        }
    </script>
}