@using OutWeb.Models.FrontEnd.TrainModels.TrainListModels
@model TrainListViewModel
@{
    ViewBag.Title = "研討會";
    ViewBag.BodyClass = "Train";
    ViewBag.Subnav = "Apply";
    ViewBag.Breadcrumb = "已報名課程"; @* 最後層的麵包屑 *@
}

@* 中間層的麵包屑 *@
@section breadcrumb {
    <li><a href="~/Train">研討會</a></li>
}

<div class="wrap zoom">
    @Html.Partial("../Train/sidebar")


    <form id="content" action="/User/TrainList" method="get" id="frmTrainList">

        <div class="text-left field list-search">

            @{
                string beginDateStr = Model.Filter.BeginDate == DateTime.MinValue ? new DateTime(DateTime.UtcNow.AddHours(8).Year, 01, 01).ToString("yyyy\\/MM\\/dd") : Model.Filter.BeginDate.ToString("yyyy\\/MM\\/dd");
                string endDateStr = Model.Filter.EndDate == DateTime.MaxValue ? new DateTime(DateTime.UtcNow.AddHours(8).Year, 12, 31).ToString("yyyy\\/MM\\/dd") : Model.Filter.EndDate.ToString("yyyy\\/MM\\/dd");
            }
            <div class="col-6 col-sm-3 date">
                <div class="input-group">
                    <label class="input-group-addon" for="bdate">起</label>
                    <span class="input-group-box"><input class="form-element datepicker" type="text" name="bdate" id="bdate" value="@beginDateStr"></span>
                </div>
            </div>
            <div class="col-6 col-sm-3 date pr-0">
                <div class="input-group">
                    <label class="input-group-addon" for="edate">迄</label>
                    <span class="input-group-box"><input class="form-element datepicker" type="text" name="edate" id="edate" value="@endDateStr"></span>
                </div>
            </div>
            <div class="col-sm-4 offset-sm-2">
                <div class="input-group">
                    <label for="qry" class="sr-only">關鍵字</label>
                    <span class="input-group-box"><input class="form-element" type="search" name="qry" id="qry" placeholder="請輸入關鍵字" value="@Model.Filter.QueryString"></span>
                    <button class="input-group-btn" type="button" id="searchBtn">查詢</button>
                </div>
            </div>
        </div><!-- list-search //-->

        <table class="table-list rwd-table">
            <thead class="list-head">
                <tr>
                    <th>修改</th>
                    <th>活動日期</th>
                    <th class="text-left">課程名稱</th>
                    <th>報名參加</th>
                    <th>報名完成</th>
                    <th>額滿候補</th>
                    <th>繳費狀況</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var data in Model.Result.Data)
                {
                    if (data.ActivityStatus)
                    {
                        <tr>

                            <td data-title="修改" class="item">
                                <a href="@Url.Content("~/User/TrainApply?trainID=" + data.ID+"&applyID=" + data.ApplyID)" class="font-xl text-info ti-pencil-alt" title="按我修改"></a>

                                @*@if (data.IsStopRegistering)
                                    {
                                        <a href="@Url.Content("~/User/TrainApply?trainID=" + data.ID+"&applyID=" + data.ApplyID)" class="font-xl text-info ti-pencil-alt" title="按我修改"></a>
                                    }
                                    else
                                    {
                                        <a href="javascript:;" class="font-xl text-info ti-pencil-alt" title="@data.RegistrationStatusDescription"></a>
                                    }*@
                            </td>
                            <td data-title="活動日期" class="text-primary">@data.ActivityDateStr</td>
                            <td data-title="課程名稱" class="text-left">
                                <a href="@Url.Content("~/Train/Content?trainID=" + data.ID)">@data.ActivityName</a>
                            </td>
                            <td data-title="報名參加">@data.AlreadyRegistered</td>
                            <td data-title="報名完成">@data.Completed</td>
                            <td data-title="額滿候補">@data.FullOfWaiting</td>
                            <td data-title="繳費狀況">@data.ChargesStatusString</td>
                        </tr>
                    }

                }

                @*<tr>
                        <td data-title="修改" class="item">
                            <a href="~/User/TrainApply" class="font-xl text-info ti-pencil-alt" title="按我修改"></a>
                        </td>
                        <td data-title="日期" class="text-primary">2017/10/25</td>
                        <td data-title="課程名稱" class="text-left">
                            <a href="~/Train/Content">xxxxxxxxxxx課程(高雄場)</a>
                        </td>
                        <td data-title="報名參加">5</td>
                        <td data-title="報名完成">4</td>
                        <td data-title="額滿候補">1</td>
                        <td data-title="繳費狀況">免費</td>
                    </tr>
                    <tr>
                        <td data-title="修改" class="item">
                            <a href="~/User/TrainApply" class="font-xl text-info ti-pencil-alt" title="按我修改"></a>
                        </td>
                        <td data-title="日期" class="text-primary">2017/10/25</td>
                        <td data-title="課程名稱" class="text-left">
                            <a href="~/Train/Content">xxxxxxxxxxx課程(台中場)</a>
                        </td>
                        <td data-title="報名參加">5</td>
                        <td data-title="報名完成">5</td>
                        <td data-title="額滿候補">0</td>
                        <td data-title="繳費狀況">免費</td>
                    </tr>
                    <tr>
                        <td data-title="修改" class="item">
                            <a href="~/User/TrainApply" class="font-xl text-info ti-pencil-alt" title="按我修改"></a>
                        </td>
                        <td data-title="日期" class="text-primary">2017/2/25</td>
                        <td data-title="課程名稱" class="text-left">
                            <a href="~/Train/Content">xxxxxxxxxxx課程(高雄場)</a>
                        </td>
                        <td data-title="報名參加">5</td>
                        <td data-title="報名完成">4</td>
                        <td data-title="額滿候補">1</td>
                        <td data-title="繳費狀況">免費</td>
                    </tr>*@
            </tbody>
        </table>


        <nav class="pager text-info">
            @{
                int beginCount = Model.Result.Pagination.CurrentPage > 1 ? ((Model.Result.Pagination.CurrentPage - 1) * Model.Result.Pagination.PageSize) + 1 : 1;
                int lastCount =
                    Model.Result.Data.Count >= Model.Result.Pagination.PageSize ?
                    ((Model.Result.Pagination.CurrentPage) * Model.Result.Pagination.PageSize) : Model.Result.Pagination.DataCount;
                string disabledPre = Model.Result.Pagination.CurrentPage == 1 ? "disabled" : "";
                string disabledNext = Model.Result.Pagination.CurrentPage == Model.Result.Pagination.LastPage ? "disabled" : "";
                string disabledPageInput = Model.Result.Pagination.LastPage == 1 ? "disabled" : "";
                string pageTotalInfo = string.Format("{0}/{1}頁 {2}筆", Model.Result.Pagination.CurrentPage, Model.Result.Pagination.LastPage, Model.Result.Pagination.DataCount);
            }
            <span class="pull-left">
                @pageTotalInfo
            </span>


            <a @disabledPre href="javascript:;"
               onclick="paginationSubmit('@Model.Result.Pagination.FirstPage');"
               class="btn ti-angle-double-left"><i class="sr-only">最前一筆</i></a>
            <a @disabledPre href="javascript:;"
               onclick="paginationSubmit('@Model.Result.Pagination.PrePage');"
               class="btn ti-angle-left"><i class="sr-only">上一筆</i></a>
            <a @disabledNext href="javascript:;"
               onclick="paginationSubmit('@Model.Result.Pagination.NextPage');"
               class="btn ti-angle-right"><i class="sr-only">下一筆</i></a>
            <a @disabledNext href="javascript:;"
               onclick="paginationSubmit('@Model.Result.Pagination.LastPage');"
               class="btn ti-angle-double-right"><i class="sr-only">最後一筆</i></a>

            <label for="numPage" class="ml-16">
                第
                <input @disabledPageInput id="numPage" name="page" class="form-element inline text-center" type="number" min="1" value="@Model.Result.Pagination.CurrentPage">
                頁
            </label>
        </nav>
    </form><!-- content //-->

</div>


@section scripts {
    <script>

        if ('@TempData["Error"]' != '')
        {
            alert('@TempData["Error"]');
        }


        function paginationSubmit(page)
        {
            $('#numPage').val(page);
            $('#frmTrainList')[0].submit();
        }

        $(function () {
            $('a').each(function (i,e) {
                var $elm =$(e);
                if($elm.attr('disabled') != undefined)
                {
                    $elm.attr('href','javascript:;').attr('onclick','javascript:;');
                }
            });

            //搜尋
            $('#searchBtn').click(function () {
                $('#numPage').val(1);
                $('#frmTrainList').submit();
            });

            //分頁input
            $('#numPage').on('keyup change', function () {
                var minPage = @Model.Result.Pagination.FirstPage;
                var maxPage = @Model.Result.Pagination.LastPage;
                var currentPage=$(this).val() ;
                if(currentPage < minPage)
                {
                    currentPage = minPage;
                }

                if(currentPage > maxPage)
                {
                    currentPage = maxPage;
                }
                $(this).val(currentPage);
                $('#frmTrainList').submit();
            })
        })
    </script>
}